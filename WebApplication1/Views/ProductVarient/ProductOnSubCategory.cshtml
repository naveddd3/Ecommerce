@model Domain.Entities.WebsiteModel;
<style>
    #variantDetailsTable {
        border-collapse: collapse;
    }

        #variantDetailsTable th,
        #variantDetailsTable td {
            border: none !important;
        }
</style>
@if (Model.ProductVarientAPIRES != null && Model.ProductVarientAPIRES.Products.Count() > 0)
{
    @foreach (var product in Model.ProductVarientAPIRES.Products)
    {
        <div class="col-lg-1-5 col-md-4 col-12 col-sm-6">
            <div class="product-cart-wrap mb-30">
                <div class="product-img-action-wrap">
                    <div class="product-img product-img-zoom">
                        <a href='shop-product-right.html'>
                            <img class="default-img productImage" src="@product.ImageUrl"  alt="" />
                            <img class="hover-img" src="@product.ImageUrl" alt="" />
                        </a>
                    </div>
                    <div class="product-action-1">
                        <a aria-label='Add To Wishlist' class='action-btn' href='shop-wishlist.html'><i class="fi-rs-heart"></i></a>
                        <a aria-label='Compare' class='action-btn' href='shop-compare.html'><i class="fi-rs-shuffle"></i></a>
                        <button aria-label="Quick view" class="action-btn" id="quickviewOpenModal" onclick="productDetail(@product.ProductId)"><i class="fi-rs-eye"></i></button>
                    </div>
                    <div class="product-badges product-badges-position product-badges-mrg">
                        <span class="hot">Hot</span>
                    </div>
                </div>
                <div class="product-content-wrap">
                    <div class="product-category">
                        <a>@product.SubCategoryName</a>
                    </div>
                    <h2><a class="productname">@product.ProductName</a></h2>
                    @if (product.IsVarient)
                    {
                        var list = Model.ProductVarientAPIRES.ProductVarients.Where(p => p.ProductId == product.ProductId);
                        if (list != null && list.Count() > 0)
                        {
                            <select class="form-select variantSelect">
                                <option value="@product.ProductId" data-quantity="@product.Quantity"
                                        data-unittype="@product.UnitType"
                                        data-price="@product.SellingPrice"
                                        data-description="@product.Description"
                                        data-img="@product.ImageUrl"
                                        data-name="@product.ProductName"
                                        data-productId="@product.ProductId">
                                    @Convert.ToInt32(product.Quantity)@product.UnitType
                                </option>
                                @foreach (var varients in list)
                                {
                                    <option value="@varients.VarientId" data-quantity="@varients.Quantity"
                                            data-unittype="@varients.UnitType"
                                            data-price="@varients.SellingPrice"
                                            data-description="@varients.Description"
                                            data-img="@varients.ImageUrl"
                                            data-name= "@varients.ProductName"
                                            data-productId ="@varients.ProductId"
                                            data-varientId="@varients.VarientId">@Convert.ToInt32(varients.Quantity)@varients.UnitType
                                    </option>
                                }
                            </select>
                        }

                    }
                    else
                    {
                        <p class="unit">@product.Quantity@product.UnitType.ToLower()</p>
                    }
                    <div class="product-card-bottom">
                        <div class="product-price">
                            <span>&#8377;@product.SellingPrice</span>
                            <span class="old-price">&#8377;@product.MRP</span>
                        </div>
                        <div class="add-cart">
                            <a class='add addtoCart' onclick="addToCart('@product.ProductId', this)"><i class="fi-rs-shopping-cart mr-5"></i>Add </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
}
<div class="modal fade" id="variantModal" tabindex="-1" aria-labelledby="variantModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="variantModalLabel"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table" id="variantDetailsTable">
                    <tbody id="variantDetails"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script src="~/js/cart.js"></script>
<script>
    $(document).ready(function () {
        $('.variantSelect').on('mousedown',function (event) {
            debugger
            event.preventDefault();
            var allOptions = $(this).find('option');
            var modalContent = '';
            var name = $(this).closest('.product-cart-wrap').find('.productname').text();
            allOptions.each(function () {
                var variantId = $(this).val();
                if (variantId) { 
                    debugger
                    var quantity = $(this).data('quantity');
                    var unitType = $(this).data('unittype');
                    var price = $(this).data('price');
                    var description = $(this).data('description');
                    var image = $(this).data('img');
                    var productId = $(this).data('productid');
                    var varientId = $(this).data('varientid');
                    modalContent += `
                                <tr>
                                    <td><img src="${image}" alt="Variant Image" style="width: 100px; height: 100px;"></td>
                                                <td>${parseInt(quantity)}${ unitType.toLowerCase() } </td>
                                        <td>₹${price} </td>
                                            <td hidden>${varientId} </td>
                                            <td><div class="product-extra-link2 ms-3">
                                                <button type="submit" onclick="addToCart(${productId},this)" class="button button-add-to-cart">
                                            <i class="fi-rs-shopping-cart"></i>Add
                                        </button>
                                    </div>
                                        </td>
                                </tr>
                    `;
                }
            });
            $('#variantDetails').html(modalContent);
            $('#variantModal').modal('show');
            $('#variantModalLabel').text(name);
        });
    });
    var productDetail = (productId) => {
        $.post("/ProductVarient/ProductDetail", { productId: productId }).done((res) => {
            $("#productDetail").html(res);
            $("#quickViewModal").modal("show");
        })
    }



</script>