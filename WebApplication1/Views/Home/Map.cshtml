@{
    Layout = null;
}

<!-- <script src="https://js.arcgis.com/4.6/"></script> -->
<div id="viewDiv"></div>
<div id="instruction">Click any location on the map to see its street address!</div>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="stylesheet" href="https://js.arcgis.com/4.7/esri/css/main.css">
    <title>Laura's Map</title>
    <style>
        html,
        body,
        #viewDiv {
         padding:0;
         margin:0;
         height:100%;
         width:100%;
        }
    </style>
    <link rel="stylesheet" href="https://js.arcgis.com/4.7/esri/css/main.css">
    <script src="https://js.arcgis.com/4.7/"></script>
    <script>
          require([
            "esri/Map",
            "esri/views/MapView",
            "esri/widgets/CoordinateConversion",
            "esri/widgets/Search",
            "esri/widgets/BasemapToggle",
            "esri/tasks/Locator",
            "dojo/when",
            "dojo/domReady!"
            ],function(Map, MapView, CoordinateConversion, Search, BasemapToggle, Locator, dojoWhen){
         //locatior url for addresses
            var locatorTask = new Locator({
              url:
         "https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"
            });

            var map = new Map({
                basemap: "streets-navigation-vector"
              });
              var view = new MapView({
                container: "viewDiv",
                map: map,
        // code for zoom in map and positioning
                zoom:15,
                center:[-122.100900,47.697028]
            });
        // search widget
        var searchWidget = new Search({
          view: view
        });
         // Coordinate display widget
        var ccWidget = new CoordinateConversion({
         view: view
        });
        // basemap toggle widget
        var toggle = new BasemapToggle({
          view:view,
          nextBasemap: "hybrid"
          });
            // view.on("click", function(event) {
            //   event.stopPropagation();
            //   //overwrite default click-for-popup behavior
            //   //get the coordinates of the click on the view
            //   var lat = Math.round(event.mapPoint.latitude * 1000)/
            //   1000;
            //   var lon = Math.round(event.mapPoint.longitude * 1000)/
            //   1000;
            //   view.popup.open({
            //   title:"Where Am I?: [" + lon + ", " + lat + "]",
            //   location: event.mapPoint
            //   //set the location of the popup to the clicked location
            // });
            //  //display the popup
            // //execute a reverse geocode using the clicked location
            //  dojoWhen(locatorTask.locationToAddress(event.mapPoint),
            // function(response) {
            //   view.popup.content = response.address;
            // }, function(err) {
            //   view.popup.content = "No address was found for this location" + err;
            // })
            // });
            view.on("click", function (event) {
                event.stopPropagation();
                // Perform reverse geocoding
                locatorTask.locationToAddress(event.mapPoint)
                    .then(function (response) {
                        let res = response;
                        console.log(JSON.stringify(res))
                        let areaName = response.attributes.Region || "Unknown Region"; // Use 'Region' or appropriate field
                        view.popup.open({
                            title: "Area: " + areaName, // Display the area name
                            content: response.address, // Show the full address in the content
                            location: event.mapPoint
                        });
                    })
                    .catch(function (err) {
                        view.popup.open({
                            title: "No address found",
                            content: "No address was found for this location. Error: " + err.message,
                            location: event.mapPoint
                        });
                    });
            });

            //togggle for basemap in top-right corner
            view.ui.add(toggle,"top-right");
            //toggle for coordinate widget in bottom-left corner
            view.ui.add(ccWidget, "bottom-left");
            //search in top-right corner
            view.ui.add(searchWidget,{position: "top-right"});
              });
    </script>
</head>
<body>
    <div id="viewDiv"></div>
</body>
